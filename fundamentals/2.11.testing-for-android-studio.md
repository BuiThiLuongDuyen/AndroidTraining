---
title: テスト(AndroidStudio)
description: この章ではAndroidStudioでのユニットテストについて解説します。
keywords: ["android","training", "基礎", "スキル", "開発", "developer", "プログラミング", "test", "UnitTest"]

---
## 目次

- [利用するツールについて](#tools)
- テストの準備
  - [dependenciesの追加](#add_dependencies)
  - [testInstrumentationRunnerの設定](#add_testInstrumentationRunner)
- [テストの作成](#add_test_class)
- [ユニットテスト](#ユニットテスト)
  - [テストの設定](#テストの設定)
  - [テストの実行](#テストの実行)
  - [テストレポート](#テストレポート)


## <a name="tools" />利用するツールについて
この章ではテストツールとしてEspressoを利用します。
Espressoは、Googleが公開したAndroid用のUIテスティングフレームワークで、2015年5月現在Android support libraryでサポートされているため、ここではEspressoを利用します。  
Espressoは、JUnit4が使えるため従来に比べ記述方法がシンプルになるなど利点が多いため、UIテストをする場合には積極的に活用していくのがよいでしょう。  
UIに関連のないユニットテストを行うためには[Robolectric](http://robolectric.org/)の方が高速にテストを実施することが出来ます。(現在のところRobolectricについては解説しません、後日追記するかもしれません)


## テストの準備
テストを実施する前に何点かテスト対象のモジュール内のbuild.gradleの編集が必要になります。

### <a name="add_dependencies" />dependenciesの追加
build.gradleのdependenciesに下記の2行を追加します

``` groovy
dependencies {
    androidTestCompile 'com.android.support.test.espresso:espresso-core:2.0'
    androidTestCompile 'com.android.support.test:testing-support-lib:0.1'
}
```

LICENSE.txt等のファイルの重複エラーが出た場合はgradleのエラーメッセージに従い、下記のような記述を追記するとよいでしょう。　

``` groovy
android {
    packagingOptions {
        pickFirst 'LICENSE.txt'
    }
}
```

### <a name="add_testInstrumentationRunner" />testInstrumentationRunnerの設定

同じくbuild.gradleのdefaultConfigのtestInstrumentationRunnerにandroid.support.test.runner.AndroidJUnitRunnerを設定します。

``` groovy
android {
    defaultConfig {
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }
}
```

ここまで出来たら一度ビルドを実行してみるとよいでしょう。
エラーが発生する場合は、gradleのエラーメッセージを見ながら解決していきましょう

## <a name="add_test_class" />テストの作成
AndroidStudio上でテスト対象のファイル内で`cmd+shift+t` または、クラスのクラス宣言にカーソルを合わせ、`alt+Enter`reate Test を選択します。  
すると、下記のようなダイアログが表示されます。

TODO: ダイアログ画像

これ以降の説明でJUnit4を使うので、JUnit4を選択します。(別のtesting libraryを選択したい場合はそれを選んでも構いません)  
setUp/tearDownのチェックボックスは必要に応じてチェックを入れてください。  
また、テスト対象のメソッドにはチェックを入れておくと自動生成されるので便利です。
OKボタンを押下すると、Diredtory Structureの選択画面になります。  
ここでは、`src/androidTest/java/`以下のものを選択します。

すると、下記のようなファイルが作成されます

```java
package com.example.sample;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;

/**
 * Created by XXX on yy/mm/dd.
 */
public class SampleViewTest {

    @Before
    public void setUp() throws Exception {

    }

    @After
    public void tearDown() throws Exception {

    }

    @Test
    public void testNewView() throws Exception {

    }
}
```

これでテストファイルの作成が出来たので一度テストを実行してみましょう。  
その際、Androidの実機、またはエミュレータが必要なので、利用できる状態にしておくとよいでしょう。  
右クリックメニューからRunを選択します。この時androidのシンボルのついたテストを選択します。

TODO: 画像

何も記述していないので無事テストが完了すると思います。

また、AndroidStudioのビルドシステムはgradleに統一されているため、コマンドラインからテストを実行することも出来ます。  
その場合は、下記コマンドで実行出来ます(テストが全部実行されます)

```
./gradlew connectedAndroidTest
```



## テストディレクトリの作成
## ユニットテスト
### テストの設定
### テストの実行
#### IDE
#### コマンド
### テストレポート
